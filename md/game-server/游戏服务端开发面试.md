# 游戏服务端开发面试

## 专业基础

### 网络

- 网络传输模型
- 滑动窗口技术
- 建立连接的三次握手 与 断开链接的四次挥手
- TCP/IP协议的传输效率
- 解释`DOS`攻击与`DRDOS`攻击的基本原理
- 一个`100Byte`的数据包精简到了`50Byte`,起传输效率提高了 50%
- `TIMEWAIT`状态怎么解释
- 常用的网络通信模型 `Select`
- 常用的网络通信模型 `Epoll`, 边缘触发与平台触发的区别和应用
- `Select`和`Epoll`的区别和应用

### 存储

- 计算机系统存储体系
- 程序运行时内存结构
- 计算机文件系统，页表结构
- 内存池与对象池的实现原理，应用场景与区别
- 关系型数据库`MySQL`的使用
- 共享内存

### 程序

- 对 `C/C++` 有较深的理解
- 深刻理解接口，封装与多态，有实践经验
- 深刻理解常用的数据结构：数组，链表，二叉树，哈希表
- 熟悉常用的算法及相关复杂度：冒泡排序 快速排序

### 游戏开发入门

#### 防御式编程

- 不要相信客户端数据，一定要检验; 作为服务端，是无法确定你的客户端是谁(可能是黑客伪造的请求)
- 函数内部，对于收到的参数；函数调用，对于函数发返回值；这两者都要进行合法的判断
- 内部子系统之间不要过于信任，要求高内聚，低耦合；
- 插件式模块设计，功能模块的健壮性应该是内建的，而不是依赖外部环境的稳定


#### 设计模式

- 道法自然，不要迷信迷恋设计模式
- 简化，简化，再简化


#### 网络模型

- 自己造轮子: `Select` `Epoll` , `Epoll`一定比`Select`高效么?
- 开源框架: `Libevent` `Libev` `ACE`

#### 数据持久化

- 选择存储系统要考虑的因素：稳定性，性能，可扩展性
- 自定义文件存储 ，如《梦幻西游》
- 关系型数据库，如 `MySQL`
- No-SQL数据库, 如 `MongoDB`

#### 内存管理

- 使用内存池和对象池，禁止运行期间动态分配内存
- 对于输入输出的指针参数，严格检查，宁滥勿缺
- 写内存包含，使用带内存保护的函数 `strncpy` `memcpy` `snprintf` `vsnprintf` 等
- 严防数组下标越界
- 防止读内存溢出, 确保字符串以 `\\0` 结束

#### 日志系统

- 简单高效， 大量日志操作不应该影响程序性能
- 稳定 做到服务器崩溃，日志不丢失
- 完备 玩家关键操作一定记录在日志里, 理想状态下，通过日志能够重建任何时刻的玩家数据
- 开关 开发日志要加级别开关控制

#### 通信协议

- PDL(Protocol Design Language) 如 `Protobuf`, 可以同时生成前后端代码，减少前后端联调成本，拓展性好
- JSON 文本协议，简单，自解释，无联调成本，拓展性好，方便包过滤 以及 写入日志
- 自定义二进制协议，精简，高效的传输性能，完全可控，几乎无拓展性

#### 全局唯一Key GUID

- 为合服做准备
- 方便追踪道具，装备流向
- 每个角色，装备，道具是全局唯一Key GUID


#### 多线程与同步

- 消息队列进行同步化处理

#### 状态机

- 强化角色的状态
- 前置状态的检查校验

#### 数据包操作

- 合并，同一帧内的数据包进行合并，减少`IO`操作次数
- 单副本，用一个包尽量只保存一份，减少内存复制次数
- AOI同步中减少中间过程无用数据包

#### 状态监控

- 随时监控服务器内部状态
- 内存池，对象池使用情况
- 帧处理时间
- 网络IO
- 包处理性能
- 各种业务逻辑的处理次数

#### 包频率控制

- 基于每个玩家每条协议的包频率控制，瘫痪变速齿轮

#### 开关控制

- 每个模块都有开关，可以紧急关闭任何出问题的功能模块

#### 反外挂和反作弊

- 包频率控制可以消灭变速齿轮
- 包id自增校验，可以消灭 `WPE`
- 包校验码可以消灭或者拦截篡改的包
- 图形识别码，可以踢掉 99% 非人的操作

#### 热更新

- 核心配置逻辑的热更新，如防沉迷系统，包频率控制，开关控制
- 代码基本热更新，如 `Erlang` `Lua`

#### 防刷

- 关键系统资源的产出日志
- 资源的产出和消耗尽量依赖两个或者两个以上的独立条件的检测
- 严格检查各项操作的前置条件
- 检验参数合法性

#### 防崩溃

- 系统底层与具体业务逻辑无关，可以用大量机器人压力测试，暴露各种BUG,确保稳定
- 业务逻辑建议使用脚本，系统性的保证游戏不会崩溃


#### 性能优化

- IO 操作异步化
- IO 操作合并缓写
- Cache 机制
- 减少竞态条件,避免频繁进出切换，尽量减少锁定使用，多线程不一定比单线程快
- 减少内存复制
- 自己测试，用数据说话，别猜


#### 运营支持

- 接口支持: 实时查询，控制指令，数据监控，客服处理
- 实现考虑提供 http 接口


#### 容灾与故障预案


## 服务器架构

### 好的架构

- 满足

























































